import { useState, useEffect } from "react";
import Head from "next/head";
import Header from "@/components/Header";
import Card from "@/components/Card"
import { useSession, signIn, signOut } from "next-auth/react"

export default function Home() {

  const { data: session, status } = useSession()
  const userEmail = session?.user?.email

  const [testArray, setTestArray] = useState([]);
  useEffect(() => {
    fetch("https://api.capy.lol/v1/capybaras?take=25&random=true")
      .then(res => res.json())
<<<<<<< HEAD
      .then(data => setTestArray(data.data))
    print("Fetched")
=======
      .then(data=> setTestArray(data.data))
    console.log("Fetched")
>>>>>>> 58d76c502cb5d474809f2b12d6e1b8e8edf4ddeb
  }, [])

  const cardsList = testArray.map(capy => {
    return (<Card img={capy.url} key={capy.index} />)
  })

  console.log(testArray)
  console.log(cardsList)

  if (status === "authenticated") {

    return (


      <>
        <Head>
          <title>Feed App</title>
          <meta name="description" content="Generated by create next app" />
          <meta name="viewport" content="width=device-width, initial-scale=1" />
          <link rel="icon" href="/favicon.ico" />
        </Head>

        <Header />

        <main >
          <p>Signed in as {userEmail}</p>
          <button onClick={() => signOut()}>Sign out</button>
          {cardsList}
        </main>

      </>
    );
  }
  return (
    <>
      <Head>
        <title>Feed App</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <p>Not signed in.</p>
      <button onClick={() => signIn("github")}>Sign in</button>
    </>
  )
}
